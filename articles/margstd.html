<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Marginal standardization • risks</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Marginal standardization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">risks</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/risks.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/margstd.html">Marginal standardization</a></li>
    <li><a class="dropdown-item" href="../articles/models.html">Models and model comparisons</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stopsack/risks/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Marginal standardization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stopsack/risks/blob/main/vignettes/margstd.Rmd" class="external-link"><code>vignettes/margstd.Rmd</code></a></small>
      <div class="d-none name"><code>margstd.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-basics">The basics<a class="anchor" aria-label="anchor" href="#the-basics"></a>
</h2>
<p>Marginal standardization, <code>approach = "margstd_delta"</code> and
<code>approach = "margstd_boot"</code>, makes use of the good
convergence properties of the logit link, which is also guaranteed to
result in probabilities within (0; 1).</p>
<p>After fitting a logistic model, predicted probabilities for each
observation are obtained for the levels of the exposure variable. Risk
ratios and risk differences are calculated by contrasting the predicted
probabilities as ratios or differences. Standard errors and confidence
intervals are obtained via the delta method or via bootstrapping the
entire procedure.</p>
<p>We use the same example data as in the <a href="risks.html#an-example-cohort-study">Get Started vignette</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stopsack.github.io/risks/">risks</a></span><span class="op">)</span>  <span class="co"># provides riskratio(), riskdiff(), postestimation functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>  <span class="co"># For data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span>  <span class="co"># For tidy() model summaries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">breastcancer</span><span class="op">)</span></span></code></pre></div>
<p>We fit the same risk difference model as in the <a href="risks.html#adjusted-risk-differences">Get Started vignette</a>,
this time explicitly specifying
<code>approach = "margstd_delta"</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_margstd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskratio.html">riskdiff</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">death</span> <span class="op">~</span> <span class="va">stage</span> <span class="op">+</span> <span class="va">receptor</span>, </span>
<span>                        data <span class="op">=</span> <span class="va">breastcancer</span>, </span>
<span>                        approach <span class="op">=</span> <span class="st">"margstd_delta"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_margstd</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Risk difference model, fitted via marginal standardization of a logistic model with delta method (margstd_delta).</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = death ~ stage + receptor, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = breastcancer, start = "(no starting values)")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients: (3 not defined because of singularities)</span></span>
<span><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; stageStage I    0.00000    0.00000     NaN      NaN    </span></span>
<span><span class="co">#&gt; stageStage II   0.16303    0.05964   2.734  0.00626 ** </span></span>
<span><span class="co">#&gt; stageStage III  0.57097    0.09962   5.732 9.95e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 228.15  on 191  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 185.88  on 188  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 193.88</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence intervals for coefficients: (delta method)</span></span>
<span><span class="co">#&gt;                     2.5 %    97.5 %</span></span>
<span><span class="co">#&gt; stageStage I   0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; stageStage II  0.04614515 0.2799187</span></span>
<span><span class="co">#&gt; stageStage III 0.37571719 0.7662158</span></span></code></pre></div>
<p>Consistent with earlier results, we observed that women with stage
III breast cancer have a 57 percentage points higher risk of death,
adjusting for hormone receptor status.</p>
<p>Note that coefficients and standard errors are only estimated for the
exposure variable. Model fit characteristics and predicted values stem
directly from the underlying logistic model.</p>
</div>
<div class="section level2">
<h2 id="choice-of-exposure-variable">Choice of exposure variable<a class="anchor" aria-label="anchor" href="#choice-of-exposure-variable"></a>
</h2>
<p>Standardization can only be done over one exposure variable, and thus
no coefficients are estimated for other variables in the model.</p>
<ul>
<li>By default, the first right-hand variable in the model formula will
be assumed to be the exposure. The variable types <code>logical</code>,
<code>factor</code>, <code>ordered</code>, and <code>character</code>
are taken to represent categorical variables.</li>
<li>Using <code>variable =</code>, a different variable can be
specified.</li>
<li>Using <code>at =</code>, levels for contrasts and the order of
levels can be specified. The first level is used as the reference with a
risk ratio of 1 or a risk difference of 0. A warning will be shown for
continuous values if the requested levels exceed the range of data
(extrapolation).</li>
</ul>
<p>Requesting estimates for a different exposure variable, using
<code>variable = "receptor"</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_margstd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskratio.html">riskdiff</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">death</span> <span class="op">~</span> <span class="va">stage</span> <span class="op">+</span> <span class="va">receptor</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">breastcancer</span>, </span>
<span>                         approach <span class="op">=</span> <span class="st">"margstd_delta"</span>, variable <span class="op">=</span> <span class="st">"receptor"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_margstd2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Risk difference model, fitted via marginal standardization of a logistic model with delta method (margstd_delta).</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = death ~ stage + receptor, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = breastcancer, start = "(no starting values)")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients: (3 not defined because of singularities)</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)  </span></span>
<span><span class="co">#&gt; receptorHigh  0.00000    0.00000     NaN      NaN  </span></span>
<span><span class="co">#&gt; receptorLow   0.16163    0.07454   2.169   0.0301 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 228.15  on 191  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 185.88  on 188  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 193.88</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence intervals for coefficients: (delta method)</span></span>
<span><span class="co">#&gt;                   2.5 %    97.5 %</span></span>
<span><span class="co">#&gt; receptorHigh 0.00000000 0.0000000</span></span>
<span><span class="co">#&gt; receptorLow  0.01554788 0.3077201</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bootstrap-confidence-intervals">Bootstrap confidence intervals<a class="anchor" aria-label="anchor" href="#bootstrap-confidence-intervals"></a>
</h2>
<p>Marginal standardization cannot rely on analytical standard error
formulae. One approach (<code>"margstd_delta"</code>) is the delta
method. Alternatively, parametric bootstrapping
(<code>"margstd_boot"</code> with the default,
<code>bootci = "bca"</code>) can be used: given the initial
maximum-likelihood estimates of the coefficients and the observed
predictors, the outcome vector is predicted from a binomial
distribution. The model is fit again using the predicted outcomes and
observed predictors. Repeating this process generates the empirical
distribution of the coefficients.</p>
<p>Confidence intervals for coefficients are calculated based on
BC<sub>a</sub> confidence intervals for parametric bootstrapping (Efron
B, Narasimhan B. The Automatic Construction of Bootstrap Confidence
Intervals. <a href="https://pubmed.ncbi.nlm.nih.gov/33727780/" class="external-link">J Comput
Graph Stat 2020;29(3):608-619</a>).</p>
<p>For comparison purposes, alternative approaches to bootstrapping and
confidence interval estimation can requested in <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>,
<code>summary.margstd()</code>, and <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>:</p>
<ul>
<li>
<code>bootci = "normal"</code>: Normality-based confidence intervals
after parametric bootstrapping. These may give out-of-range estimates
for confidence limits.</li>
<li>
<code>bootci = "nonpar"</code>: BC<sub>a</sub> intervals after
<em>nonparametric</em> bootstrapping. Here, the data are resampled,
rather than the outcome predicted from the model. Especially in the
small datasets in which regular binomial models with log links may not
converge and marginal standardization may be the only option, resampling
the data comes with the risk of empty strata in the resamples, resulting
in sparse-data bias or model nonconvergence. The resulting confidence
intervals may be too narrow. This option should be used with
caution.</li>
</ul>
<p>When using <code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code> to access model results, the parameter
<code>bootverbose = TRUE</code> will add bootstrapping parameters and
properties to the tibble:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_margstd3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskratio.html">riskdiff</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">death</span> <span class="op">~</span> <span class="va">stage</span> <span class="op">+</span> <span class="va">receptor</span>, </span>
<span>                         data <span class="op">=</span> <span class="va">breastcancer</span>, </span>
<span>                         approach <span class="op">=</span> <span class="st">"margstd_boot"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_margstd3</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Risk difference model, fitted via marginal standardization of a logistic model with bootstrapping (margstd_boot).</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = death ~ stage + receptor, family = binomial(link = "logit"), </span></span>
<span><span class="co">#&gt;     data = breastcancer, start = "(no starting values)")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients: (3 not defined because of singularities)</span></span>
<span><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; stageStage I    0.00000    0.00000     NaN      NaN    </span></span>
<span><span class="co">#&gt; stageStage II   0.16303    0.06178   2.639  0.00832 ** </span></span>
<span><span class="co">#&gt; stageStage III  0.57097    0.09860   5.791 7.01e-09 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 228.15  on 191  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 185.88  on 188  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 193.88</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Confidence intervals for coefficients: (1000 BCa bootstrap repeats)</span></span>
<span><span class="co">#&gt;                     2.5%     97.5%</span></span>
<span><span class="co">#&gt; stageStage I   0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; stageStage II  0.0235973 0.2684382</span></span>
<span><span class="co">#&gt; stageStage III 0.3615643 0.7337180</span></span>
<span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit_margstd3</span>, bootverbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">statistic</span>, <span class="op">-</span><span class="va">p.value</span><span class="op">)</span>  <span class="co"># allow the other columns to get printed instead</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 10</span></span></span>
<span><span class="co">#&gt;   term       estimate std.error conf.low conf.high bootrepeats bootci jacksd.low</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl[1d&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> stageStag…    0        0        0          0            <span style="text-decoration: underline;">1</span>000 bca      <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> stageStag…    0.163    0.058<span style="text-decoration: underline;">0</span>   0.044<span style="text-decoration: underline;">7</span>     0.269        <span style="text-decoration: underline;">1</span>000 bca       0.004<span style="text-decoration: underline;">66</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> stageStag…    0.571    0.104    0.329      0.744        <span style="text-decoration: underline;">1</span>000 bca       0.009<span style="text-decoration: underline;">53</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: jacksd.high &lt;dbl&gt;, model &lt;chr&gt;</span></span></span></code></pre></div>
<ul>
<li>
<code>bootrepeats</code>: Number of bootstrap repeats.</li>
<li>
<code>bootci</code>: Type of bootstrap confidence interval
(<code>bca</code>, <code>normal</code>, or <code>nonpar</code>, see
above).</li>
<li>
<code>jacksd.low</code> and <code>jacksd.high</code>:
Jackknife-based Monte-Carlo standard errors for the lower and upper
limits of the confidence interval. Available for <code>bca</code>
intervals only. If these simulation errors are large compared to the
desired precision of the confidence limits, then the number of bootstrap
repeats needs to be substantially increased.</li>
</ul>
</div>
<div class="section level2">
<h2 id="bootstrap-repeats">Bootstrap repeats<a class="anchor" aria-label="anchor" href="#bootstrap-repeats"></a>
</h2>
<p>The default are (currently) only 1000 bootstrap repeats to reduce
initial computation time. If the calculation of BC<sub>a</sub>
confidence intervals fails with an error, and for final, precise
estimates, the number of repeats should be increased to &gt;&gt;1000.
Use the option <code>bootrepeats =</code> in <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>,
<code><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy()</a></code>, or <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>.</p>
<p>For reproducibility, a seed should be set (e.g.,
<code>set.seed(123)</code>).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Konrad Stopsack, Travis Gerke.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
