<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal standardization â€¢ risks</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Marginal standardization">
<meta property="og:description" content="risks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">risks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/risks.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/margstd.html">Marginal standardization</a>
    </li>
    <li>
      <a href="../articles/models.html">Models and model comparisons</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stopsack/risks/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="margstd_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Marginal standardization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stopsack/risks/blob/master/vignettes/margstd.Rmd"><code>vignettes/margstd.Rmd</code></a></small>
      <div class="hidden name"><code>margstd.Rmd</code></div>

    </div>

    
    
<div id="the-basics" class="section level1">
<h1 class="hasAnchor">
<a href="#the-basics" class="anchor"></a>The basics</h1>
<p>Marginal standardization, <code>approach = "margstd"</code>, makes use of the good convergence properties of the logit link, which is also guaranteed to result in probabilities within (0; 1).</p>
<p>After fitting a logistic model, predicted probabilities for each observation are obtained for the levels of the exposure variable. Risk ratios and risk differences are calculated by contrasting the predicted probabilities as ratios or differences. Standard errors and confidence intervals are obtained via bootstrapping the entire procedure.</p>
<p>We use the same example data as in the <a href="risks.html#an-example-cohort-study">Get Started vignette</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stopsack/risks">risks</a></span><span class="op">)</span>  <span class="co"># provides riskratio(), riskdiff(), postestimation functions</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>  <span class="co"># For data handling</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>  <span class="co"># For tidy() model summaries</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  death    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">54</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">138</span><span class="op">)</span><span class="op">)</span>,
  stage    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage I"</span>, <span class="fl">7</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage II"</span>, <span class="fl">26</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage III"</span>, <span class="fl">21</span><span class="op">)</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage I"</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage II"</span>, <span class="fl">70</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Stage III"</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,
  receptor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">2</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">5</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">9</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">17</span><span class="op">)</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">12</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">9</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">50</span><span class="op">)</span>,
               <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">57</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="fl">2</span><span class="op">)</span>,  <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"High"</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We fit the same risk difference model as in the <a href="risks.html#adjusted-risk-differences">Get Started vignette</a>, this time specifying <code>approach = "margstd"</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_margstd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskratio.html">riskdiff</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">death</span> <span class="op">~</span> <span class="va">stage</span> <span class="op">+</span> <span class="va">receptor</span>, data <span class="op">=</span> <span class="va">dat</span>, 
                        approach <span class="op">=</span> <span class="st">"margstd"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_margstd</span>, bootrepeats <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Risk difference model, fitted via marginal standardization of a logistic model (margstd).</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::glm(formula = death ~ stage + receptor, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = dat, start = "(no starting values)")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients: (3 not defined because of singularities)</span>
<span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="co">#&gt; stageStage I    0.00000    0.00000      NA       NA    </span>
<span class="co">#&gt; stageStage II   0.16303    0.05998   2.718  0.00657 ** </span>
<span class="co">#&gt; stageStage III  0.57097    0.09588   5.955  2.6e-09 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 228.15  on 191  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 185.88  on 188  degrees of freedom</span>
<span class="co">#&gt; AIC: 193.88</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence intervals for coefficients: (500 BCa bootstrap repeats)</span>
<span class="co">#&gt;                      2.5%     97.5%</span>
<span class="co">#&gt; stageStage I           NA        NA</span>
<span class="co">#&gt; stageStage II  0.03870299 0.2681392</span>
<span class="co">#&gt; stageStage III 0.36973499 0.7557005</span></code></pre></div>
<p>Consistent with earlier results, we observed that women with stage III breast cancer have a 57 percentage points higher risk of death, adjusting for hormone receptor status (with slightly different bootstrapped 95% confidence intervals).</p>
<p>Note that coefficients and standard errors are only estimated for the exposure variable. Model fit characteristics and predicted values stem directly from the underlying logistic model.</p>
</div>
<div id="choice-of-exposure-variable" class="section level1">
<h1 class="hasAnchor">
<a href="#choice-of-exposure-variable" class="anchor"></a>Choice of exposure variable</h1>
<p>Standardization can only be done over one exposure variable, and thus no cofficients are estimated for other variables in the model. In addition, in order to derive contrasts, continuous exposures have to be evaluated at discrete levels.</p>
<ul>
<li>By default, the first categorical right-hand variable in the model formula will be assumed to be the exposure. The variable types <code>logical</code>, <code>factor</code>, <code>ordered</code>, and <code>character</code> are taken to represent categorical variables, as are variables of the type <code>numeric</code> with only two levels (e.g., <code>0</code> and <code>1</code>).</li>
<li>Using <code>variable =</code>, a different variable can be specified.</li>
<li>Using <code>at =</code>, levels for contrasts and the order of levels can be specified. The first level is used as the reference with a risk ratio of 1 or a risk difference of 0. The option <code>at =</code> is required for continuous variables or <code>numeric</code> variables with more than two levels. A warning will be shown for continuous values if the requested levels exceed the range of data (extrapolation).</li>
</ul>
<p>Requesting estimates for a different exposure variable, using <code>variable = "receptor"</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_margstd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskratio.html">riskdiff</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">death</span> <span class="op">~</span> <span class="va">stage</span> <span class="op">+</span> <span class="va">receptor</span>, data <span class="op">=</span> <span class="va">dat</span>, 
                         approach <span class="op">=</span> <span class="st">"margstd"</span>, variable <span class="op">=</span> <span class="st">"receptor"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_margstd2</span>, bootrepeats <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Risk difference model, fitted via marginal standardization of a logistic model (margstd).</span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::glm(formula = death ~ stage + receptor, family = binomial(link = "logit"), </span>
<span class="co">#&gt;     data = dat, start = "(no starting values)")</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Deviance Residuals: </span>
<span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span>
<span class="co">#&gt;                                         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients: (3 not defined because of singularities)</span>
<span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">#&gt; receptorHigh  0.00000    0.00000      NA       NA  </span>
<span class="co">#&gt; receptorLow   0.16163    0.07488   2.159   0.0309 *</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     Null deviance: 228.15  on 191  degrees of freedom</span>
<span class="co">#&gt; Residual deviance: 185.88  on 188  degrees of freedom</span>
<span class="co">#&gt; AIC: 193.88</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Number of Fisher Scoring iterations: 4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Confidence intervals for coefficients: (500 BCa bootstrap repeats)</span>
<span class="co">#&gt;                    2.5%     97.5%</span>
<span class="co">#&gt; receptorHigh         NA        NA</span>
<span class="co">#&gt; receptorLow  0.01891486 0.3240358</span></code></pre></div>
</div>
<div id="bootstrap-confidence-intervals" class="section level1">
<h1 class="hasAnchor">
<a href="#bootstrap-confidence-intervals" class="anchor"></a>Bootstrap confidence intervals</h1>
<p>Marginal standardization does not rely on analytical standard error formulae or the delta method. Instead, parametric bootstrapping is used: given the initial maximum-likelihood estimates of the coefficients and the observed predictors, the outcome vector is predicted from a binomial distribution. The model is fit again using the predicted outcomes and observed predictors. Repeating this process generates the empirical distribution of the coefficients.</p>
<p>Confidence intervals for coefficients are calculated based on BC<sub>a</sub> confidence intervals for parametric bootstrapping (Efron B, Narasimhan B. The Automatic Construction of Bootstrap Confidence Intervals. <a href="https://doi.org/10.1080/10618600.2020.1714633">J Comput Graph Stat 2020;29(3):608-619</a>).</p>
<p>For comparison purposes, alternative approaches to bootstrapping and confidence interval estimation can requested in <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>, <code><a href="../reference/summary.margstd.html">summary.margstd()</a></code>, and <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code>:</p>
<ul>
<li>
<code>bootci = "normal"</code>: Normality-based confidence intervals after parametric bootstrapping. These may give out-of-range estimates for confidence limits.</li>
<li>
<code>bootci = "nonpar"</code>: BC<sub>a</sub> intervals after <em>nonparametric</em> bootstrapping. Here, the data are resampled, rather than the outcome predicted from the model. Especially in the small datasets in which regular binomial models with log links may not converge and marginal standardization may be the only option, resampling the data comes with the risk of empty strata in the resamples, resulting in sparse-data bias or model nonconvergence. The resulting confidence intervals may be too low. This option should be used with caution.</li>
</ul>
</div>
<div id="bootstrap-repeats" class="section level1">
<h1 class="hasAnchor">
<a href="#bootstrap-repeats" class="anchor"></a>Bootstrap repeats</h1>
<p>The default are (currently) only 200 bootstrap repeats to reduce initial computation time. If the calculation of BC<sub>a</sub> confidence intervals fails with an error, and for final, precise estimates, the number of repeats should be increased to &gt;&gt;1000. Use the option <code>bootrepeats =</code> in <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>, <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>, or <code><a href="https://rdrr.io/r/stats/confint.html">confint()</a></code>.</p>
<p>For reproducibility, a seed should be set (e.g., <code><a href="https://rdrr.io/r/base/Random.html">set.seed(123)</a></code>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Konrad Stopsack, Travis Gerke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
